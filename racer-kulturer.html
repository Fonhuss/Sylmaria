<!doctype html>
<html lang="da">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Sylmaria – Racer & Kulturer</title>
  <meta name="description" content="Racer og kulturer i Sylmaria. Indlæser indhold fra JSON-fil for nem redigering." />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@500;700&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#0b0d13; --panel:#11141b; --muted:#8a94a6; --text:#e6eaf2; --accent:#e2b714; --accent-2:#7bd4ff; --radius:18px; --shadow:0 10px 30px rgba(0,0,0,.45);
    }
    *{ box-sizing:border-box }
    html,body{ height:100% }
    body{ margin:0; font-family:Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial; background:radial-gradient(1200px 600px at 10% -20%, #0f1320 0%, var(--bg) 40%) no-repeat, radial-gradient(1600px 900px at 120% 20%, #12182a 0%, transparent 40%) no-repeat, var(--bg); color:var(--text) }
    a{ color:inherit; text-decoration:none }

    header.site{ position:sticky; top:0; z-index:10; backdrop-filter:blur(8px); background:linear-gradient(180deg, rgba(11,13,19,.85), rgba(11,13,19,.55)); border-bottom:1px solid rgba(255,255,255,.06) }
    .bar{ width:min(1200px, 100% - 32px); margin-inline:auto; padding:12px 0; display:flex; align-items:center; gap:12px }
    .brand{ display:flex; align-items:center; gap:10px; font-family:Cinzel, serif }
    .sigil{ width:24px; height:24px; border-radius:7px; background:conic-gradient(from 220deg, #ffed9a, #ffd86b, #b88a12, #3a2a00, #ffed9a) }
    .brand b{ letter-spacing:.5px }
    .bar a.btn{ margin-left:auto; display:inline-flex; align-items:center; gap:8px; padding:8px 12px; border-radius:10px; border:1px solid rgba(255,255,255,.1); color:var(--text); background:#0f131c }
    .bar a.btn:hover{ box-shadow:0 0 0 2px rgba(226,183,20,.25), 0 0 0 6px rgba(226,183,20,.08); border-color:#3d2d00 }

    main{ width:min(1200px, 100% - 32px); margin-inline:auto; padding:24px 0 48px; display:grid; grid-template-columns: 260px 1fr; gap:22px }

    /* Sidebar / indholdsfortegnelse */
    .toc{ position:sticky; top:76px; align-self:start; background:rgba(17,20,27,.92); border:1px solid rgba(255,255,255,.08); border-radius:12px; padding:12px; backdrop-filter:blur(8px) }
    .toc h3{ margin:0 0 8px; font-family:Cinzel,serif; font-size:16px }
    .toc a{ display:block; padding:6px 8px; border-radius:8px; color:#cfd6e6; font-size:14px }
    .toc a:hover{ background:#0f131c }

    /* Hero */
    .hero{ grid-column:1/-1; display:grid; grid-template-columns: 1.2fr .8fr; gap:18px; align-items:center }
    .hero .cover{ border-radius:var(--radius); overflow:hidden; background:linear-gradient(120deg,#152033,#0e1118); aspect-ratio: 16/9; box-shadow:var(--shadow); display:flex; align-items:center; justify-content:center }
    .hero h1{ font-family:Cinzel, serif; font-size: clamp(26px, 3.5vw, 40px); margin:0 0 8px }
    .hero p{ color:var(--muted); margin:0 }

    /* Søgning */
    .search{ display:flex; gap:8px; margin: 6px 0 12px }
    .search input{ flex:1; padding:10px 12px; border-radius:10px; border:1px solid rgba(255,255,255,.12); background:#0f131c; color:var(--text) }
    .search input:focus{ outline:none; box-shadow:0 0 0 2px rgba(226,183,20,.25), 0 0 0 6px rgba(226,183,20,.08); border-color:#3d2d00 }

    /* Cards/sektioner */
    section.block{ background:rgba(17,20,27,.92); border:1px solid rgba(255,255,255,.08); border-radius:16px; padding:16px; margin-bottom:16px }
    .block h2{ font-family:Cinzel,serif; margin:0 0 8px; font-size:22px }
    .block .meta{ font-size:13px; color:#c7cfde; margin:-4px 0 10px }
    .block p{ margin:0 0 8px; color:#e7ecf7 }
    .grid-two{ display:grid; grid-template-columns: 1fr 1fr; gap:12px }
    .pill{ display:inline-flex; align-items:center; gap:6px; padding:4px 8px; border:1px solid rgba(255,255,255,.14); border-radius:999px; font-size:12px; color:#dfe6f8; background:#0f131c; margin:4px 6px 0 0 }

    .empty{ padding:16px; border-radius:10px; background:#0f131c; color:#cfd6e6; border:1px dashed rgba(255,255,255,.15) }

    /* Responsiv */
    @media (max-width: 980px){ main{ grid-template-columns: 1fr; } .hero{ grid-template-columns: 1fr; } .toc{ position:static } }
  </style>
</head>
<body>
  <header class="site">
    <div class="bar">
      <div class="brand"><div class="sigil" aria-hidden="true"></div><b>Sylmaria – Racer & Kulturer</b></div>
      <a class="btn" href="./">← Til forsiden</a>
    </div>
  </header>

  <main>
    <div class="hero">
      <div>
        <h1 id="pageTitle">Racer & Kulturer</h1>
        <p id="pageDesc">Data indlæses fra <code>assets/races_of_sylmaria.json</code>. Ret den fil for at opdatere teksten – siden opdaterer automatisk.</p>
        <div class="search">
          <input id="q" type="search" placeholder="Søg: elvere, mennesker, goliaths, kultur…" autocomplete="off" />
        </div>
      </div>
      <div class="cover">
        <span style="opacity:.85;color:#ffeb99;font-family:Cinzel,serif;letter-spacing:.5px">Sylmaria Compendium</span>
      </div>
    </div>

    <!-- TOC -->
    <nav class="toc" aria-label="Indholdsfortegnelse">
      <h3>Indhold</h3>
      <div id="tocLinks"></div>
    </nav>

    <!-- Content container -->
    <div id="content"></div>
  </main>

  <script>
    const JSON_URL = 'assets/races_of_sylmaria.json'; // læg din JSON her

    // Dansk titel-mapping
    const SECTION_TITLES = {
      elves: 'Elves',
      dwarves_halflings_gnomes: 'Dwarves, Halflings & Gnomes',
      humans: 'Humans',
      half_elves_half_orcs: 'Half elves & Half Orcs',
      goliaths: 'Goliaths',
      exotic_breeds: 'Exotic Races',
      cultures_affiliations: 'Cultures & Affiliations'
    };

    // Hjælpere
    const el = (tag, attrs={}, ...children) => {
      const node = document.createElement(tag);
      for(const [k,v] of Object.entries(attrs||{})){
        if(k==='class') node.className = v; else if(k==='html') node.innerHTML = v; else node.setAttribute(k,v);
      }
      for(const c of children){ if(c==null) continue; node.appendChild(typeof c === 'string' ? document.createTextNode(c) : c); }
      return node;
    };

    function buildSection(key, data){
      const title = SECTION_TITLES[key] || key;
      const id = key;
      const wrap = el('section', {class:'block', id});
      wrap.appendChild(el('h2', {html:title}));
      if(data.summary) wrap.appendChild(el('p', {html: data.summary}));

      // del-opslag i to kolonner hvis muligt
      const grid = el('div', {class:'grid-two'});
      let putAny = false;
      for(const subKey of ['culture','faith','beliefs','cultures','dwarves','halflings','gnomes','half_elves','half_orcs','duty','themes','note','world','questions','theme','purpose']){
        if(data[subKey]){ putAny = true; grid.appendChild(el('div', {html:`<b style="font-family:Cinzel,serif">${labelize(subKey)}</b><br>${data[subKey]}`})); }
      }

      // elvere: subraces
      if(data.subraces){
        const pills = el('div');
        for(const [srk,txt] of Object.entries(data.subraces)){
          pills.appendChild(el('span', {class:'pill'}, labelize(srk)));
        }
        grid.appendChild(el('div', {}, el('b',{html:'Undergrene'}), el('div', {style:'margin-top:6px'}, pills)));
        putAny = true;
      }

      if(putAny) wrap.appendChild(grid);
      return wrap;
    }

    function labelize(key){
      const map = {
        culture:'Cultures', faith:'Faith', beliefs:'Beliefs', cultures:'Cultures', dwarves:'Dwarves', halflings:'Halflings', gnomes:'Gnomes',
        half_elves:'Half Elves', half_orcs:'Half Orcs', duty:'Duty', themes:'Themes', note:'Note', world:'World', questions:'Questions', theme:'Theme', purpose:'Purpose',
        shadow_elves:'Shadow Elves'
      };
      return map[key] || key.replace(/_/g,' ').replace(/\b\w/g, m=>m.toUpperCase());
    }

    function buildTOC(sections){
      const toc = document.getElementById('tocLinks'); toc.innerHTML='';
      for(const key of Object.keys(sections)){
        const title = SECTION_TITLES[key] || key;
        toc.appendChild(el('a', {href:'#'+key}, title));
      }
    }

    function render(data){
      // hero title/desc
      document.getElementById('pageTitle').textContent = 'Racer & Kulturer';
      if(data.description){ document.getElementById('pageDesc').textContent = data.description; }

      const content = document.getElementById('content');
      content.innerHTML = '';
      buildTOC(data.sections||{});
      for(const [key, val] of Object.entries(data.sections||{})){
        content.appendChild(buildSection(key, val));
      }

      // søgning
      const q = document.getElementById('q');
      const blocks = Array.from(document.querySelectorAll('section.block'));
      q.addEventListener('input', ()=>{
        const v = q.value.trim().toLowerCase();
        blocks.forEach(b=>{
          const t = b.innerText.toLowerCase(); b.style.display = v && !t.includes(v) ? 'none' : '';
        });
      });
    }

    async function init(){
      try{
        const res = await fetch(JSON_URL, {cache:'no-store'});
        if(!res.ok) throw new Error('Kunne ikke hente '+JSON_URL+' ('+res.status+')');
        const data = await res.json();
        render(data);
      }catch(err){
        console.error(err);
        document.getElementById('content').innerHTML = `<div class="empty">Kunne ikke indlæse <code>${JSON_URL}</code>.<br>Placér filen i <code>/assets/</code> med samme navn, eller ret stien i denne side.<br><br><small>Fejl: ${err.message}</small></div>`;
      }
    }

    init();
  </script>
</body>
</html>
